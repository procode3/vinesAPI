"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[2812],{19150:function(U,f,t){t.d(f,{R:function(){return E}});var e=t(19565),n=t(33348),y=t(20108);function E(L={},T={}){const{id:c="",...C}=L,h=(0,n.stringify)(C,{encode:!1}),{get:S}=(0,e.kY)(),{data:g,isError:b,isLoading:A,refetch:O}=(0,y.useQuery)(["users",c,C],async()=>{const{data:{data:I}}=await S(`/admin/users/${c}${h?`?${h}`:""}`);return I},T);let v=[];return c&&g?v=[g]:Array.isArray(g?.results)&&(v=g.results),{users:v,pagination:g?.pagination??null,isLoading:A,isError:b,refetch:O}}},83196:function(U,f,t){var e=t(32735),n=t(72850),y=t(41415),E=t(19565),L=t(5644),T=t(60216),c=t.n(T),C=t(67879);const h=({displayedFilters:S})=>{const[g,b]=(0,e.useState)(!1),{formatMessage:A}=(0,C.Z)(),O=(0,e.useRef)(),v=()=>{b(I=>!I)};return e.createElement(e.Fragment,null,e.createElement(n.x,{paddingTop:1,paddingBottom:1},e.createElement(y.z,{variant:"tertiary",ref:O,startIcon:e.createElement(L.Z,null),onClick:v,size:"S"},A({id:"app.utils.filters",defaultMessage:"Filters"})),g&&e.createElement(E.J5,{displayedFilters:S,isVisible:g,onToggle:v,source:O})),e.createElement(E.W$,{filtersSchema:S}))};h.propTypes={displayedFilters:c().arrayOf(c().shape({name:c().string.isRequired,metadatas:c().shape({label:c().string}),fieldSchema:c().shape({type:c().string})})).isRequired},f.Z=h},71765:function(U,f,t){t.r(f),t.d(f,{default:function(){return ve}});var e=t(32735),n=t(19565),y=t(15062),E=t(78125),L=t(96709),T=t(17e3),c=t(72850),C=t(27649),h=t(82055),S=t(99223),g=t(67879),b=t(83196),A=t(20108),O=t(53038),v=t(19150),X=({canReadAuditLogs:a,canReadUsers:d})=>{const{get:u}=(0,n.kY)(),{search:i}=(0,O.TH)(),m=(0,n.lm)(),r={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:R=>m({type:"warning",message:R.message})},{users:s,isError:l,isLoading:p}=(0,v.R)({},{...r,enabled:d,staleTime:2*(1e3*60)}),{data:M,isLoading:P,isError:Z}=(0,A.useQuery)(["auditLogs",i],async({queryKey:R})=>{const D=R[1],{data:Me}=await u(`/admin/audit-logs${D}`);return Me},{...r,enabled:a});return{auditLogs:M,users:s,isLoading:p||P,hasError:Z||l}},w=t(85025),k=t(55225),q=t(31600),_=t(26858),ee=t(51654),te=t(60216),o=t.n(te),ae=t(96315),N=()=>{const{formatDate:a}=(0,g.Z)();return u=>{const i=(0,ae.Z)(u),m=a(i,{dateStyle:"long"}),r=a(i,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${r}`}},B=t(87933),se=t(23866),F=t(49372),ne=t(15335),oe=t(64710);const H={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},$=a=>H[a]||a,Q=({actionLabel:a,actionName:d})=>e.createElement(B.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(F.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(F.Z,{textColor:"neutral600"},d));Q.propTypes={actionLabel:o().string.isRequired,actionName:o().string.isRequired};var x=Q;const W=({status:a,data:d,formattedDate:u})=>{const{formatMessage:i}=(0,g.Z)();if(a==="loading")return e.createElement(B.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(se.a,null,"Loading content..."));const{action:m,user:r,payload:s}=d;return e.createElement(e.Fragment,null,e.createElement(c.x,{marginBottom:3},e.createElement(F.Z,{variant:"delta",id:"title"},i({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ne.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(x,{actionLabel:i({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:i({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:$(m)},{model:s?.model})}),e.createElement(x,{actionLabel:i({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:u}),e.createElement(x,{actionLabel:i({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:r?.displayName||"-"}),e.createElement(x,{actionLabel:i({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:r?.id.toString()||"-"})),e.createElement(oe.V,{value:JSON.stringify(s,null,2),disabled:!0,label:i({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};W.defaultProps={data:{}},W.propTypes={status:o().oneOf(["idle","loading","error","success"]).isRequired,data:o().shape({action:o().string,date:o().string,payload:o().object,user:o().object}),formattedDate:o().string.isRequired};var ie=W;const Y=({handleClose:a,logId:d})=>{const{get:u}=(0,n.kY)(),i=(0,n.lm)(),m=async M=>{const{data:P}=await u(`/admin/audit-logs/${M}`);if(!P)throw new Error("Audit log not found");return P},{data:r,status:s}=(0,A.useQuery)(["audit-log",d],()=>m(d),{onError(){i({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),l=N(),p=r?l(r.date):"";return e.createElement(w.P,{onClose:a,labelledBy:"title"},e.createElement(k.x,null,e.createElement(_.O,{label:p,id:"title"},e.createElement(ee.$,{isCurrent:!0},p))),e.createElement(q.f,null,e.createElement(ie,{status:s,data:r,formattedDate:p})))};Y.propTypes={handleClose:o().func.isRequired,logId:o().string.isRequired};var re=Y;const j=({pagination:a})=>e.createElement(c.x,{paddingTop:4},e.createElement(B.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(n.v4,null),e.createElement(n.tU,{pagination:a})));j.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},j.propTypes={pagination:o().shape({page:o().number,pageCount:o().number,pageSize:o().number,total:o().number})};var le=j,de=t(35658),me=t(94547),z=t(19786),ue=t(50563),ce=t(54894);const V=({headers:a,rows:d,onOpenModal:u})=>{const{formatMessage:i}=(0,g.Z)(),m=N(),r=({type:s,value:l,model:p})=>s==="date"?m(l):s==="action"?i({id:`Settings.permissions.auditLogs.${l}`,defaultMessage:$(l)},{model:p}):l||"-";return e.createElement(de.p,null,d.map(s=>e.createElement(me.Tr,{key:s.id,...(0,n.X7)({fn:()=>u(s.id)})},a.map(({key:l,name:p,cellFormatter:M})=>e.createElement(z.Td,{key:l},e.createElement(F.Z,{textColor:"neutral800"},r({type:l,value:M?M(s[p]):s[p],model:s.payload?.model})))),e.createElement(z.Td,{...n.UW},e.createElement(B.k,{justifyContent:"end"},e.createElement(ue.h,{onClick:()=>u(s.id),"aria-label":i({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${s.action} action`}),noBorder:!0,icon:e.createElement(ce.Z,null)}))))))};V.defaultProps={rows:[]},V.propTypes={headers:o().array.isRequired,rows:o().array,onOpenModal:o().func.isRequired};var ge=V,pe=t(21428),fe=t(90333);const K=({value:a,options:d,onChange:u})=>{const{formatMessage:i}=(0,g.Z)(),m=i({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(pe.hQ,{"aria-label":m,value:a,onChange:u},d.map(({label:r,customValue:s})=>e.createElement(fe.O,{key:s,value:s},r)))};K.defaultProps={value:null},K.propTypes={value:o().string,options:o().arrayOf(o().shape({label:o().string.isRequired,customValue:o().string.isRequired}).isRequired).isRequired,onChange:o().func.isRequired};var J=K;const G=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}];var Ee=({formatMessage:a,users:d,canReadUsers:u})=>{const i=Object.keys(H).map(r=>({label:a({id:`Settings.permissions.auditLogs.${r}`,defaultMessage:$(r)},{model:void 0}),customValue:r})),m=[{name:"action",metadatas:{customOperators:G,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:i,customInput:J},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(u&&d){const r=l=>l.username?l.username:l.firstname&&l.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:l.firstname,lastname:l.lastname}):l.email,s=d.map(l=>({label:r(l),customValue:l.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:G,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:s,customInput:J},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},ye=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Le=()=>{const{formatMessage:a}=(0,g.Z)(),d=(0,y.v9)(E._),{allowedActions:{canRead:u,canReadUsers:i}}=(0,n.ss)({...d.settings.auditLogs,readUsers:d.settings.users.read}),[{query:m},r]=(0,n.Kx)(),{auditLogs:s,users:l,isLoading:p,hasError:M}=X({canReadAuditLogs:u,canReadUsers:i});(0,n.go)();const P=Ee({formatMessage:a,users:l,canReadUsers:i}),Z=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),R=ye.map(D=>({...D,metadatas:{...D.metadatas,label:a(D.metadatas.label)}}));return M?e.createElement(L.A,null,e.createElement(T.D,null,e.createElement(c.x,{paddingTop:8},e.createElement(n.Hn,null)))):e.createElement(C.o,{"aria-busy":p},e.createElement(n.SL,{name:Z}),e.createElement(h.T,{title:Z,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(S.Z,{startActions:e.createElement(b.Z,{displayedFilters:P})}),e.createElement(T.D,{canRead:u},e.createElement(n.tM,{contentType:"Audit logs",headers:R,rows:s?.results||[],withBulkActions:!0,isLoading:p},e.createElement(ge,{headers:R,rows:s?.results||[],onOpenModal:D=>r({id:D})})),e.createElement(le,{pagination:s?.pagination})),m?.id&&e.createElement(re,{handleClose:()=>r({id:null},"remove"),logId:m.id}))},ve=()=>{const a=(0,y.v9)(E._);return e.createElement(n.O4,{permissions:a.settings.auditLogs.main},e.createElement(Le,null))}},90333:function(U,f,t){t.d(f,{O:function(){return n}});var e=t(21428);const n=e.Wx},99223:function(U,f,t){t.d(f,{Z:function(){return y}});var e=t(74512),n=t(87933);const y=({startActions:E,endActions:L})=>!E&&!L?null:(0,e.jsxs)(n.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(n.k,{gap:2,wrap:"wrap",children:E}),(0,e.jsx)(n.k,{gap:2,shrink:0,wrap:"wrap",children:L})]})}}]);
