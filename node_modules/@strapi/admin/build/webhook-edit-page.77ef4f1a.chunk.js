"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[5162],{5998:function(H,h,t){t.d(h,{Z:function(){return p}});var e=t(32735),c=t(70958);function u(){return e.createElement(c.Z.Root,null,e.createElement(c.Z.Headers,null),e.createElement(c.Z.Body,null))}var p=u},70958:function(H,h,t){var e=t(32735),c=t(29397),u=t(87933),p=t(76437),D=t(23866),k=t(31121),B=t(35197),g=t(38837),se=t(3685),re=t(49372),F=t(40801),X=t(8284),A=t(82884),Q=t(92802),ie=t(60216),M=t.n(ie),_=t(67879),S=t(8471),de=t(70166);const E=s=>s.reduce((l,r)=>{const y=r.split(".")[0];return l[y]||(l[y]=[]),l[y].push(r),l},{}),U=(0,S.ZP)(c.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:s})=>s.colors.neutral100};
  }

  thead th span {
    color: ${({theme:s})=>s.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:s})=>s.spaces[3]};
    padding-block-end: ${({theme:s})=>s.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    /**
     * Add padding to the start of the first column to avoid the checkbox appearing
     * too close to the edge of the table
     */
    padding-inline-start: ${({theme:s})=>s.spaces[2]};
  }
`,oe=s=>{const l=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return s&&(l.push({id:"app.utils.publish",defaultMessage:"Publish"}),l.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),l},ce=s=>{const l=["entry.create","entry.update","entry.delete"];return s&&l.push("entry.publish","entry.unpublish"),{entry:l,media:["media.create","media.update","media.delete"]}},Y=e.createContext(),le=({children:s})=>{const{formatMessage:l}=(0,_.Z)(),{collectionTypes:r,isLoading:y}=(0,de.G)(),C=e.useMemo(()=>r.some(O=>O.options.draftAndPublish===!0),[r]),L=l({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(Y.Provider,{value:{isDraftAndPublish:C}},e.createElement(u.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(p.Q,{"aria-hidden":!0},L),y&&e.createElement(D.a,null,l({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(U,{"aria-label":L},s)))};le.propTypes={children:M().oneOfType([M().arrayOf(M().node),M().node]).isRequired};const J=({getHeaders:s=oe})=>{const{isDraftAndPublish:l}=e.useContext(Y),{formatMessage:r}=(0,_.Z)(),y=s(l);return e.createElement(k.S,null,e.createElement(B.Z,null,e.createElement(g.g,null,e.createElement(se.T,null,r({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),y.map(C=>["app.utils.publish","app.utils.unpublish"].includes(C.id)?e.createElement(g.g,{key:C.id,title:r({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(re.Z,{variant:"sigma",textColor:"neutral600"},r(C))):e.createElement(g.g,{key:C.id},e.createElement(re.Z,{variant:"sigma",textColor:"neutral600"},r(C))))))};J.defaultProps={getHeaders:oe},J.propTypes={getHeaders:M().func};const N=({providedEvents:s})=>{const{isDraftAndPublish:l}=e.useContext(Y),r=s||ce(l),{values:y,handleChange:C}=(0,Q.u6)(),L="events",O=y.events,w=[],$=E(O),x=({target:{name:b,value:i}})=>{let T=new Set(O);i?T.add(b):T.delete(b),C({target:{name:L,value:Array.from(T)}})},V=({target:{name:b,value:i}})=>{let T=new Set(O);i?r[b].forEach(G=>{w.includes(G)||T.add(G)}):r[b].forEach(G=>T.delete(G)),C({target:{name:L,value:Array.from(T)}})};return e.createElement(F.X,null,Object.entries(r).map(([b,i])=>e.createElement(z,{disabledEvents:w,key:b,name:b,events:i,inputValue:$[b],handleSelect:x,handleSelectAll:V})))};N.defaultProps={providedEvents:null},N.propTypes={providedEvents:M().object};const q=s=>s.replace(/-/g," ").split(" ").map(l=>l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()).join(" "),z=({disabledEvents:s,name:l,events:r,inputValue:y,handleSelect:C,handleSelectAll:L})=>{const{formatMessage:O}=(0,_.Z)(),w=r.filter(i=>!s.includes(i)),$=y.length>0,x=y.length===w.length,V=({target:{name:i}})=>{L({target:{name:i,value:!x}})},b=5;return e.createElement(B.Z,null,e.createElement(g.f,null,e.createElement(X.X,{indeterminate:$&&!x,"aria-label":O({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:l,onChange:V,value:x},q(l))),r.map(i=>e.createElement(g.f,{key:i},e.createElement(A.C,{disabled:s.includes(i),"aria-label":i,name:i,value:y.includes(i),onValueChange:T=>C({target:{name:i,value:T}})}))),r.length<b&&e.createElement(g.f,{colSpan:`${b-r.length}`}))};z.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},z.propTypes={disabledEvents:M().array,events:M().array,inputValue:M().array,handleSelect:M().func,handleSelectAll:M().func,name:M().string.isRequired},h.Z={Root:le,Headers:J,Body:N,EventRow:z}},82167:function(H,h,t){t.d(h,{Z:function(){return pe}});var e=t(32735),c=t(27649),u=t(19565),p=t(20108),D=t(53038),k=t(70166),B=t(82055),g=t(87933),se=t(41415),re=t(17e3),F=t(72850),X=t(15335),A=t(5803),Q=t(10369),ie=t(2438),M=t(66456),_=t(29439),S=t(92802),de=t(60216),E=t.n(de),U=t(67879),oe=t(76437),ce=t(7563),Y=t(19406),le=t(21428),J=t(90333);const N=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],q=({name:n,onChange:a,value:o,...m})=>{const{values:{headers:f}}=(0,S.u6)(),[Z,d]=(0,e.useState)(N);(0,e.useEffect)(()=>{d(N.filter(v=>!f?.some(K=>K.key!==o&&K.key===v)))},[f,o]);const P=v=>{a({target:{name:n,value:v}})},ee=v=>{d(K=>[...K,v]),P(v)};return e.createElement(le.XU,{...m,onClear:()=>P(""),onChange:P,onCreateOption:ee,placeholder:"",value:o},Z.map(v=>e.createElement(J.O,{value:v,key:v},v)))};q.defaultProps={value:void 0},q.propTypes={name:E().string.isRequired,onChange:E().func.isRequired,value:E().string};var z=q,l=()=>{const{formatMessage:n}=(0,U.Z)(),{values:a,errors:o}=(0,S.u6)();return e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(oe.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(F.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(S.F2,{validateOnChange:!1,name:"headers",render:({push:m,remove:f})=>e.createElement(X.r,{gap:4},a.headers.map((Z,d)=>e.createElement(e.Fragment,{key:`${d}.${Z.key}`},e.createElement(A.P,{col:6},e.createElement(S.gN,{as:z,name:`headers.${d}.key`,"aria-label":`row ${d+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:o.headers?.[d]?.key&&o.headers[d].key})),e.createElement(A.P,{col:6},e.createElement(g.k,{alignItems:"flex-end"},e.createElement(F.x,{style:{flex:1}},e.createElement(S.gN,{as:Q.o,name:`headers.${d}.value`,"aria-label":`row ${d+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:o.headers?.[d]?.value&&o.headers[d].value})),e.createElement(g.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:o.headers?.[d]?.value?0:5},e.createElement(u.fG,{disabled:a.headers.length===1,onClick:()=>f(d),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:d+1})})))))),e.createElement(A.P,{col:12},e.createElement(ce.A,{type:"button",onClick:()=>{m({key:"",value:""})},startIcon:e.createElement(Y.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))},r=t(49372),y=t(27169),C=t(35331),L=t(8471);const O=L.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),w=({isPending:n,statusCode:a})=>{const{formatMessage:o}=(0,U.Z)();return n?e.createElement(g.k,{gap:2,alignItems:"center"},e.createElement(O,{as:y.Z}),e.createElement(r.Z,null,o({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(g.k,{gap:2,alignItems:"center"},e.createElement(O,{as:M.Z,color:"success700"}),e.createElement(r.Z,null,o({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(g.k,{gap:2,alignItems:"center"},e.createElement(O,{as:C.Z,color:"danger700"}),e.createElement(r.Z,null,o({id:"Settings.error",defaultMessage:"error"})," ",a)):null};w.propTypes={isPending:E().bool.isRequired,statusCode:E().number},w.defaultProps={statusCode:void 0};const $=({statusCode:n,message:a})=>{const{formatMessage:o}=(0,U.Z)();return n>=200&&n<300?e.createElement(g.k,{justifyContent:"flex-end"},e.createElement(r.Z,{textColor:"neutral600",ellipsis:!0},o({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(g.k,{justifyContent:"flex-end"},e.createElement(g.k,{maxWidth:(0,u.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(r.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};$.propTypes={statusCode:E().number,message:E().string},$.defaultProps={statusCode:void 0,message:void 0};const x=({onCancel:n})=>{const{formatMessage:a}=(0,U.Z)();return e.createElement(g.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(g.k,{gap:2,alignItems:"center"},e.createElement(r.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(O,{as:C.Z,color:"neutral400"}))))};x.propTypes={onCancel:E().func.isRequired};const V=({isPending:n,onCancel:a,response:o})=>{const{statusCode:m,message:f}=o,{formatMessage:Z}=(0,U.Z)();return e.createElement(F.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(X.r,{gap:4,style:{alignItems:"center"}},e.createElement(A.P,{col:3},e.createElement(r.Z,null,Z({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(A.P,{col:3},e.createElement(w,{isPending:n,statusCode:m})),e.createElement(A.P,{col:6},n?e.createElement(x,{onCancel:a}):e.createElement($,{statusCode:m,message:f}))))};V.defaultProps={isPending:!1,onCancel(){},response:{}},V.propTypes={isPending:E().bool,onCancel:E().func,response:E().object};var b=V,i=t(24346);const T=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,G=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,me=({formatMessage:n})=>i.Ry().shape({name:i.Z_().required(n({id:"Settings.webhooks.validation.name.required",defaultMessage:"Name is required"})).matches(T,n({id:"Settings.webhooks.validation.name.regex",defaultMessage:"The name must start with a letter and only contain letters, numbers, spaces and underscores"})),url:i.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(G,n({id:"Settings.webhooks.validation.url.regex",defaultMessage:"The value must be a valid Url"})),headers:i.Vo(a=>{let o=i.IX();if(a.length===1){const{key:m,value:f}=a[0];if(!m&&!f)return o}return o.of(i.Ry().shape({key:i.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:i.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:i.IX()}),Ee=(()=>window&&window.strapi&&window.strapi.isEE?t(10635).Z:t(5998).Z)(),ue=n=>{let{handleSubmit:a,triggerWebhook:o,isCreating:m,isTriggering:f,triggerResponse:Z,data:d}=n;const{formatMessage:P}=(0,U.Z)(),[ee,v]=(0,e.useState)(!1),K=W=>Object.keys(W).length?Object.entries(W).map(te=>{let[ne,ae]=te;return{key:ne,value:ae}}):[{key:"",value:""}],R=(0,S.TA)({initialValues:{name:d?.name||"",url:d?.url||"",headers:K(d?.headers||{}),events:d?.events||[]},onSubmit(W,te){let{resetForm:ne,setSubmitting:ae}=te;a(W),ne({values:W}),ae(!1)},validationSchema:me({formatMessage:P}),validateOnChange:!1,validateOnBlur:!1});return e.createElement(S.Hy,{value:R},e.createElement(u.l0,{onSubmit:R.handleSubmit},e.createElement(B.T,{primaryAction:e.createElement(g.k,{gap:2},e.createElement(se.z,{onClick:()=>{o(),v(!0)},variant:"tertiary",startIcon:e.createElement(ie.Z,null),disabled:m||f,size:"L"},P({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(se.z,{startIcon:e.createElement(M.Z,null),type:"submit",size:"L",disabled:!R.dirty,loading:R.isSubmitting},P({id:"global.save",defaultMessage:"Save"}))),title:m?P({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):d?.name,navigationAction:e.createElement(u.rU,{startIcon:e.createElement(_.Z,null),to:"/settings/webhooks"},P({id:"global.back",defaultMessage:"Back"}))}),e.createElement(re.D,null,e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:4},ee&&e.createElement(b,{isPending:f,response:Z,onCancel:()=>v(!1)}),e.createElement(F.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(g.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(X.r,{gap:6},e.createElement(A.P,{col:6},e.createElement(S.gN,{as:Q.o,name:"name",error:R?.errors?.name&&R.errors.name,label:P({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(A.P,{col:12},e.createElement(S.gN,{as:Q.o,name:"url",error:R?.errors?.url&&R.errors.url,label:P({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(l,null),e.createElement(Ee,null)))))))};ue.propTypes={data:E().object,handleSubmit:E().func.isRequired,triggerWebhook:E().func.isRequired,isCreating:E().bool.isRequired,isTriggering:E().bool.isRequired,triggerResponse:E().object},ue.defaultProps={data:void 0,triggerResponse:void 0};var he=ue;const ge=n=>({...n,headers:n.headers.reduce((a,{key:o,value:m})=>(o!==""&&(a[o]=m),a),{})});var pe=()=>{const{params:{id:n}}=(0,D.$B)("/settings/webhooks/:id"),a=n==="create",{replace:o}=(0,D.k6)(),m=(0,u.lm)(),{formatAPIError:f}=(0,u.So)(),Z=(0,p.useQueryClient)(),{isLoading:d}=(0,k.G)(),{put:P,get:ee,post:v}=(0,u.kY)(),{isLoading:K,data:R,error:W}=(0,p.useQuery)(["webhooks",n],async()=>{const{data:{data:I}}=await ee(`/admin/webhooks/${n}`);return I},{enabled:!a});e.useEffect(()=>{W&&m({type:"warning",message:f(W)})},[W,m,f]);const{isLoading:te,data:ne,isIdle:ae,mutate:fe}=(0,p.useMutation)(()=>v(`/admin/webhooks/${n}/trigger`)),ve=()=>fe(null,{onError(I){m({type:"warning",message:f(I)})}}),Me=(0,p.useMutation)(I=>v("/admin/webhooks",I)),ye=(0,p.useMutation)(({id:I,body:j})=>P(`/admin/webhooks/${I}`,j)),Ce=async I=>{if(a){Me.mutate(ge(I),{onSuccess({data:j}){m({type:"success",message:{id:"Settings.webhooks.created"}}),o(`/settings/webhooks/${j.data.id}`)},onError(j){m({type:"warning",message:f(j)})}});return}ye.mutate({id:n,body:ge(I)},{onSuccess(){Z.invalidateQueries(["webhooks",n]),m({type:"success",message:{id:"notification.form.success.fields"}})},onError(j){m({type:"warning",message:f(j)})}})};return K||d?e.createElement(u.dO,null):e.createElement(c.o,null,e.createElement(u.SL,{name:"Webhooks"}),e.createElement(he,{data:R,handleSubmit:Ce,triggerWebhook:ve,isCreating:a,isTriggering:te,isTriggerIdle:ae,triggerResponse:ne?.data.data}))}},33238:function(H,h,t){t.r(h);var e=t(32735),c=t(19565),u=t(15062),p=t(78125),D=t(82167);const k=()=>{const B=(0,u.v9)(p._);return e.createElement(c.O4,{permissions:B.settings.webhooks.create},e.createElement(D.Z,null))};h.default=k},59021:function(H,h,t){t.r(h);var e=t(32735),c=t(19565),u=t(15062),p=t(78125),D=t(82167);const k=()=>{const B=(0,u.v9)(p._);return e.createElement(c.O4,{permissions:B.settings.webhooks.update},e.createElement(D.Z,null))};h.default=k},10635:function(H,h,t){t.d(h,{Z:function(){return k}});var e=t(32735),c=t(70958);const u={"review-workflows":["review-workflows.updateEntryStage"]},p=()=>[{id:"review-workflows.updateEntryStage",defaultMessage:"Stage Change"}];function D(){return e.createElement(c.Z.Root,null,e.createElement(c.Z.Headers,null),e.createElement(c.Z.Body,null),e.createElement(c.Z.Headers,{getHeaders:p}),e.createElement(c.Z.Body,{providedEvents:u}))}var k=D},90333:function(H,h,t){t.d(h,{O:function(){return c}});var e=t(21428);const c=e.Wx},29439:function(H,h,t){t.d(h,{Z:function(){return u}});var e=t(74512);const c=p=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...p,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),u=c}}]);
